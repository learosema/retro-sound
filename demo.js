function T(s,t,e,i){let r=s.createBiquadFilter();return r.type=t,r.frequency.value=e,typeof i<"u"&&(r.Q.value=i),r}function p(s){return 440*Math.pow(2,(f(s)-69)/12)}function f(s){let t=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],e=parseInt(s.slice(-1)),i=s.slice(0,-1);return(e+1)*12+t.indexOf(i)}function d(s,t="square"){let e={osc:s.createOscillator(),gain:s.createGain()};return e.osc.type=t,e.osc.start(),e.osc.connect(e.gain),e}var a=class{constructor(t,e="square"){this.audioContext=t;this.destination=null;this.filter=null;this.time=0;this.modulator=null;this.modulators=[];this.audioContext=t,this.carrier=d(this.audioContext,e),this.output=this.carrier.gain}withFilter(t,e,i){return this.filter=T(this.audioContext,t,e,i),this.carrier.gain.connect(this.filter),this.output=this.filter,this}withModulator(t="square",e,i,r="frequency"){let m=d(this.audioContext,t);m.osc.frequency.value=e,m.gain.gain.value=i;let c=null;if(!c)switch(r){case"frequency":c=this.carrier.osc.frequency;break;case"gain":c=this.carrier.gain.gain;break;case"filter":c=this.filter?.frequency;break;case"detune":c=this.carrier.osc.detune;break;case"last":this.modulators.length>0&&(c=this.modulators.slice(-1).pop().osc.frequency)}return c&&m.gain.connect(c),this.modulators.push(m),this}toDestination(t=null){return this.destination=t||this.audioContext.destination,this.output.connect(this.destination),this}play(t,e=1,i=0){let r=this.audioContext.currentTime+i,m=p(t);return this.carrier.osc.frequency.setValueAtTime(m,r),this.carrier.gain.gain.setValueAtTime(e,r),this.time=Math.max(i,this.time),this}rampToVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.carrier.gain.gain.linearRampToValueAtTime(t,i),this.time=Math.max(e,this.time),this}expRampToVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.carrier.gain.gain.exponentialRampToValueAtTime(t,i),this.time=Math.max(e,this.time),this}rampToNoteAtTime(t,e){let i=this.audioContext.currentTime+e,r=p(t);return this.carrier.osc.frequency.exponentialRampToValueAtTime(r,i),this.time=Math.max(e,this.time),this}setToNoteAtTime(t,e){let i=this.audioContext.currentTime+e,r=p(t);return this.carrier.osc.frequency.setValueAtTime(r,i),this.time=Math.max(e,this.time),this}setVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.carrier.gain.gain.setValueAtTime(t,i),this.time=Math.max(e,this.time),this}rampFilterFreqAtTime(t,e=0){this.time=Math.max(e,this.time);let i=this.audioContext.currentTime+e;return this.filter?.frequency.linearRampToValueAtTime(t,e),this}expRampFilterFreqAtTime(t,e=0){this.time=Math.max(e,this.time);let i=this.audioContext.currentTime+e;return this.filter?.frequency.exponentialRampToValueAtTime(t,e),this}wait(){return new Promise(t=>setTimeout(t,this.time*1e3))}dispose(){this.carrier.osc.stop(),this.carrier.osc.disconnect(),this.carrier.gain.disconnect(),this.filter?.disconnect();for(let t of this.modulators)t.osc.stop(),t.osc.disconnect(),t.gain.disconnect();this.modulators=[]}async waitDispose(){await this.wait(),this.dispose()}};var l=class l{constructor(t){this.audioContext=t;this.destination=null;this.filter=null;this.time=0;this.createNoiseBuffer(t),this.bufferSource=t.createBufferSource(),this.bufferSource.buffer=l.noiseBuffer,this.bufferSource.loop=!0,this.gain=t.createGain(),this.bufferSource.connect(this.gain),this.output=this.gain}play(){return this.bufferSource.start(),this}toDestination(t=null){return this.destination=t||this.audioContext.destination,this.output.connect(this.destination),this}withFilter(t,e,i){return this.filter=T(this.audioContext,t,e,i),this.gain.connect(this.filter),this.output=this.filter,this}setFilterFreqAtTime(t,e=0){this.time=Math.max(e,this.time);let i=this.audioContext.currentTime+e;return this.filter?.frequency.setValueAtTime(t,i),this}rampFilterFreqAtTime(t,e=0){this.time=Math.max(e,this.time);let i=this.audioContext.currentTime+e;return this.filter?.frequency.linearRampToValueAtTime(t,i),this}expRampFilterFreqAtTime(t,e=0){this.time=Math.max(e,this.time);let i=this.audioContext.currentTime+e;return this.filter?.frequency.exponentialRampToValueAtTime(t,i),this}rampToVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.gain.gain.linearRampToValueAtTime(t,i),this.time=Math.max(e,this.time),this}expRampToVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.gain.gain.exponentialRampToValueAtTime(t,i),this.time=Math.max(e,this.time),this}setVolumeAtTime(t,e){let i=this.audioContext.currentTime+e;return this.gain.gain.setValueAtTime(t,i),this.time=Math.max(e,this.time),this}createNoiseBuffer(t){if(l.noiseBuffer||l.bufferSize>0)return;let e=2*t.sampleRate,i=t.createBuffer(1,e,t.sampleRate),r=i.getChannelData(0);for(let m=0;m<e;m++)r[m]=Math.random()*2-1;l.bufferSize=e,l.noiseBuffer=i}wait(){return new Promise(t=>setTimeout(t,this.time*1e3))}dispose(){this.gain.disconnect(),this.bufferSource.stop(),this.filter?.disconnect()}async waitDispose(){await this.wait(),this.dispose()}};l.bufferSize=0,l.noiseBuffer=null;var h=l;function u(s,t){return(t??document).querySelector(s)}var o=new AudioContext,n=o.createGain();n.gain.setValueAtTime(.25,0);n.connect(o.destination);u("#noise").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e4).toDestination(n).play().rampFilterFreqAtTime(1e3,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise2").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",50).toDestination(n).play().expRampFilterFreqAtTime(1e4,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise3").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e4).toDestination(n).play().expRampFilterFreqAtTime(10,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise4").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e3).toDestination(n).play().expRampFilterFreqAtTime(10,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#bling").addEventListener("click",()=>{o.resume(),new a(o,"triangle").withModulator("square",6,600,"detune").withModulator("square",12,300,"detune").withFilter("lowpass",1e3).toDestination(n).play("A5").rampToVolumeAtTime(0,1).waitDispose()});u("#ring").addEventListener("click",()=>{o.resume(),new a(o,"triangle").withModulator("square",12,300,"detune").withFilter("lowpass",400).toDestination(n).play("C5").setVolumeAtTime(1,1).rampToVolumeAtTime(0,1.25).waitDispose()});u("#laser").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("triangle",120,100).withFilter("lowpass",1800).toDestination(n).play("C6").rampToNoteAtTime("C5",.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#witch").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("sine",18,150,"detune").withModulator("sine",12,50,"last").withFilter("lowpass",1e3).withModulator("triangle",4,1e3,"filter").toDestination(n).play("A4",0).rampToVolumeAtTime(1,.125).rampToNoteAtTime("G3",3).rampToVolumeAtTime(0,3.5).waitDispose()});u("#emergency").addEventListener("click",()=>{o.resume(),new a(o,"sine").withModulator("sine",2,600,"detune").withFilter("lowpass",800).toDestination(n).play("A4").rampToVolumeAtTime(0,2).waitDispose()});u("#gameover").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("sine",4,100,"detune").withFilter("lowpass",1200).toDestination(n).play("A3").rampToNoteAtTime("E2",3).rampToVolumeAtTime(0,4).waitDispose()});u("#won").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withFilter("lowpass",800).toDestination(n).play("C3").setToNoteAtTime("E3",.25).setToNoteAtTime("G3",.5).setToNoteAtTime("C4",.75).setVolumeAtTime(1,1).rampToVolumeAtTime(0,2).waitDispose()});u("#smoke").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withFilter("lowpass",600).withModulator("sine",32,400,"filter").toDestination(n).play("C3").setVolumeAtTime(0,.25).setToNoteAtTime("D#3",.5).setVolumeAtTime(1,.5).setVolumeAtTime(0,.75).setToNoteAtTime("F3",1).setVolumeAtTime(1,1).setVolumeAtTime(1,1.5).rampToVolumeAtTime(0,1.74).setToNoteAtTime("C3",1.75).setVolumeAtTime(1,1.75).setVolumeAtTime(0,2).setToNoteAtTime("D#3",2.25).setVolumeAtTime(1,2.25).setVolumeAtTime(0,2.5).setVolumeAtTime(1,2.75).setToNoteAtTime("F#3",2.75).setVolumeAtTime(0,2.99).setVolumeAtTime(1,3).setToNoteAtTime("F3",3).setVolumeAtTime(1,3.5).rampToVolumeAtTime(0,3.75).waitDispose()});
