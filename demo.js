function T(r,e,t,i){let s=r.createBiquadFilter();return s.type=e,s.frequency.value=t,typeof i<"u"&&(s.Q.value=i),s}function p(r){return 440*Math.pow(2,(f(r)-69)/12)}function f(r){let e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],t=parseInt(r.slice(-1)),i=r.slice(0,-1);return(t+1)*12+e.indexOf(i)}function d(r,e="square"){let t={osc:r.createOscillator(),gain:r.createGain()};return t.osc.type=e,t.osc.start(),t.osc.connect(t.gain),t}var a=class{constructor(e,t="square"){this.audioContext=e;this.destination=null;this.filter=null;this.time=0;this.modulators=[];this.audioContext=e,this.carrier=d(this.audioContext,t),this.output=this.carrier.gain}withFilter(e,t,i){return this.filter=T(this.audioContext,e,t,i),this.carrier.gain.connect(this.filter),this.output=this.filter,this}withModulator(e="square",t,i,s="frequency"){let m=d(this.audioContext,e);m.osc.frequency.value=t,m.gain.gain.value=i;let c=null;if(!c)switch(s){case"frequency":c=this.carrier.osc.frequency;break;case"gain":c=this.carrier.gain.gain;break;case"filter":c=this.filter?.frequency;break;case"detune":c=this.carrier.osc.detune;break;case"last":this.modulators.length>0&&(c=this.modulators.slice(-1).pop().osc.frequency)}return c&&m.gain.connect(c),this.modulators.push(m),this}toDestination(e=null){return this.destination=e||this.audioContext.destination,this.output.connect(this.destination),this}play(e,t=1,i=0){let s=this.audioContext.currentTime+i,m=p(e);return this.carrier.osc.frequency.setValueAtTime(m,s),this.carrier.gain.gain.setValueAtTime(t,s),this.time=Math.max(i,this.time),this}rampToVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.carrier.gain.gain.linearRampToValueAtTime(e,i),this.time=Math.max(t,this.time),this}expRampToVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.carrier.gain.gain.exponentialRampToValueAtTime(e,i),this.time=Math.max(t,this.time),this}rampToNoteAtTime(e,t){let i=this.audioContext.currentTime+t,s=p(e);return this.carrier.osc.frequency.exponentialRampToValueAtTime(s,i),this.time=Math.max(t,this.time),this}setToNoteAtTime(e,t){let i=this.audioContext.currentTime+t,s=p(e);return this.carrier.osc.frequency.setValueAtTime(s,i),this.time=Math.max(t,this.time),this}setVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.carrier.gain.gain.setValueAtTime(e,i),this.time=Math.max(t,this.time),this}rampFilterFreqAtTime(e,t=0){this.time=Math.max(t,this.time);let i=this.audioContext.currentTime+t;return this.filter?.frequency.linearRampToValueAtTime(e,t),this}expRampFilterFreqAtTime(e,t=0){this.time=Math.max(t,this.time);let i=this.audioContext.currentTime+t;return this.filter?.frequency.exponentialRampToValueAtTime(e,t),this}wait(){return new Promise(e=>setTimeout(e,this.time*1e3))}dispose(){this.carrier.osc.stop(),this.carrier.osc.disconnect(),this.carrier.gain.disconnect(),this.filter?.disconnect();for(let e of this.modulators)e.osc.stop(),e.osc.disconnect(),e.gain.disconnect();this.modulators=[]}async waitDispose(){await this.wait(),this.dispose()}};var l=class l{constructor(e){this.audioContext=e;this.destination=null;this.filter=null;this.time=0;this.createNoiseBuffer(e),this.bufferSource=e.createBufferSource(),this.bufferSource.buffer=l.noiseBuffer,this.bufferSource.loop=!0,this.gain=e.createGain(),this.bufferSource.connect(this.gain),this.output=this.gain}play(e){return this.bufferSource.start(typeof e<"u"?this.audioContext.currentTime+e:void 0),this}stop(e){return this.bufferSource.stop(typeof e<"u"?this.audioContext.currentTime+e:void 0),this}toDestination(e=null){return this.destination=e||this.audioContext.destination,this.output.connect(this.destination),this}withFilter(e,t,i){return this.filter=T(this.audioContext,e,t,i),this.gain.connect(this.filter),this.output=this.filter,this}setFilterFreqAtTime(e,t=0){this.time=Math.max(t,this.time);let i=this.audioContext.currentTime+t;return this.filter?.frequency.setValueAtTime(e,i),this}rampFilterFreqAtTime(e,t=0){this.time=Math.max(t,this.time);let i=this.audioContext.currentTime+t;return this.filter?.frequency.linearRampToValueAtTime(e,i),this}expRampFilterFreqAtTime(e,t=0){this.time=Math.max(t,this.time);let i=this.audioContext.currentTime+t;return this.filter?.frequency.exponentialRampToValueAtTime(e,i),this}rampToVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.gain.gain.linearRampToValueAtTime(e,i),this.time=Math.max(t,this.time),this}expRampToVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.gain.gain.exponentialRampToValueAtTime(e,i),this.time=Math.max(t,this.time),this}setVolumeAtTime(e,t){let i=this.audioContext.currentTime+t;return this.gain.gain.setValueAtTime(e,i),this.time=Math.max(t,this.time),this}createNoiseBuffer(e){if(l.noiseBuffer||l.bufferSize>0)return;let t=2*e.sampleRate,i=e.createBuffer(1,t,e.sampleRate),s=i.getChannelData(0);for(let m=0;m<t;m++)s[m]=Math.random()*2-1;l.bufferSize=t,l.noiseBuffer=i}wait(){return new Promise(e=>setTimeout(e,this.time*1e3))}dispose(){this.gain.disconnect(),this.bufferSource.stop(),this.filter?.disconnect()}async waitDispose(){await this.wait(),this.dispose()}};l.bufferSize=0,l.noiseBuffer=null;var h=l;function u(r,e){return(e??document).querySelector(r)}var o=new AudioContext,n=o.createGain();n.gain.setValueAtTime(.25,0);n.connect(o.destination);u("#noise").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e4).toDestination(n).play().rampFilterFreqAtTime(1e3,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise2").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",50).toDestination(n).play().expRampFilterFreqAtTime(1e4,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise3").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e4).toDestination(n).play().expRampFilterFreqAtTime(10,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#noise4").addEventListener("click",()=>{o.resume(),new h(o).withFilter("lowpass",1e3).toDestination(n).play().expRampFilterFreqAtTime(10,.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#bling").addEventListener("click",()=>{o.resume(),new a(o,"triangle").withModulator("square",6,600,"detune").withModulator("square",12,300,"detune").withFilter("lowpass",1e3).toDestination(n).play("A5").rampToVolumeAtTime(0,1).waitDispose()});u("#ring").addEventListener("click",()=>{o.resume(),new a(o,"triangle").withModulator("square",12,300,"detune").withFilter("lowpass",400).toDestination(n).play("C5").setVolumeAtTime(1,1).rampToVolumeAtTime(0,1.25).waitDispose()});u("#laser").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("triangle",120,100).withFilter("lowpass",1800).toDestination(n).play("C6").rampToNoteAtTime("C5",.25).rampToVolumeAtTime(0,.5).waitDispose()});u("#witch").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("sine",18,150,"detune").withModulator("sine",12,50,"last").withFilter("lowpass",1e3).withModulator("triangle",4,1e3,"filter").toDestination(n).play("A4",0).rampToVolumeAtTime(1,.125).rampToNoteAtTime("G3",3).rampToVolumeAtTime(0,3.5).waitDispose()});u("#emergency").addEventListener("click",()=>{o.resume(),new a(o,"sine").withModulator("sine",2,600,"detune").withFilter("lowpass",800).toDestination(n).play("A4").rampToVolumeAtTime(0,2).waitDispose()});u("#gameover").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withModulator("sine",4,100,"detune").withFilter("lowpass",1200).toDestination(n).play("A3").rampToNoteAtTime("E2",3).rampToVolumeAtTime(0,4).waitDispose()});u("#won").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withFilter("lowpass",800).toDestination(n).play("C3").setToNoteAtTime("E3",.25).setToNoteAtTime("G3",.5).setToNoteAtTime("C4",.75).setVolumeAtTime(1,1).rampToVolumeAtTime(0,2).waitDispose()});u("#smoke").addEventListener("click",()=>{o.resume(),new a(o,"sawtooth").withFilter("lowpass",600).withModulator("sine",32,400,"filter").toDestination(n).play("C3").setVolumeAtTime(0,.25).setToNoteAtTime("D#3",.5).setVolumeAtTime(1,.5).setVolumeAtTime(0,.75).setToNoteAtTime("F3",1).setVolumeAtTime(1,1).setVolumeAtTime(1,1.5).rampToVolumeAtTime(0,1.74).setToNoteAtTime("C3",1.75).setVolumeAtTime(1,1.75).setVolumeAtTime(0,2).setToNoteAtTime("D#3",2.25).setVolumeAtTime(1,2.25).setVolumeAtTime(0,2.5).setVolumeAtTime(1,2.75).setToNoteAtTime("F#3",2.75).setVolumeAtTime(0,2.99).setVolumeAtTime(1,3).setToNoteAtTime("F3",3).setVolumeAtTime(1,3.5).rampToVolumeAtTime(0,3.75).waitDispose()});
